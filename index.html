<!DOCTYPE html>
<html lang="en">

<head>

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <title>Liste courses</title>

</head>

<body>

<div id="list-div" class="column">
</div>

<div class="column">
<br>
<button class="press-button" onclick="exportList()">EXPORT</button>
</div>

</body>

    <script>

    document.body.onload = populateList;

    var itemList = [
    //
    // salle de bain
    //
    {idHome: 0, idShop: 1, name: "dentifrice"},
    {idHome: 0, idShop: 1, name: "shampoing (C)"},
    {idHome: 0, idShop: 1, name: "shampoing (J)"},
    {idHome: 0, idShop: 1, name: "après-shampoing"},
    {idHome: 0, idShop: 1, name: "protections"},
    //
    // garage
    //
    {idHome: 0, idShop: 3, name: "PQ"},
    {idHome: 0, idShop: 6.5, name: "gâteaux apéro"},
    {idHome: 0, idShop: 6.5, name: "gâteaux café"},
    {idHome: 0, idShop: 6.3, name: "café"},
    {idHome: 0, idShop: 3, name: "lessive"},
    {idHome: 0, idShop: 3.5, name: "tablettes lave vaisselle"},
    {idHome: 0, idShop: 3, name: "sac poubelle 50L"},
    {idHome: 0, idShop: 3, name: "liquide vaisselle"},
    {idHome: 0, idShop: 3, name: "lave sol"},
    {idHome: 0, idShop: 3, name: "lave-vitre"},
    {idHome: 0, idShop: 3, name: "vinaigre blanc"},
    {idHome: 0, idShop: 3, name: "cillit bang"},
    {idHome: 0, idShop: 3, name: "éponge"},
    {idHome: 0, idShop: 1, name: "lingettes lunettes"},
    {idHome: 0, idShop: 12, name: "fruits / légumes"},
    {idHome: 0, idShop: 12, name: "bananes"},
    {idHome: 0, idShop: 12, name: "oranges"},
    {idHome: 0, idShop: 12, name: "pommes de terre"},
    {idHome: 0, idShop: 12, name: "oignons"},
    {idHome: 0, idShop: 8.3, name: "mozzarella"},
    {idHome: 0, idShop: 8.3, name: "feta"},
    {idHome: 0, idShop: 12.5, name: "reblochon"},
    {idHome: 0, idShop: 8.2, name: "yaourt faisselle"},
    {idHome: 0, idShop: 8.2, name: "yaourt grec"},
    {idHome: 0, idShop: 8.2, name: "yaourt enfants"},
    {idHome: 0, idShop: 6, name: "moutarde"},
    {idHome: 0, idShop: 6, name: "cornichon"},
    {idHome: 0, idShop: 6, name: "ketchup"},
    {idHome: 0, idShop: 8.2, name: "beurre"},
    {idHome: 0, idShop: 6.2, name: "huile d'olive"},
    {idHome: 0, idShop: 6.2, name: "vinaigrette"},
    {idHome: 0, idShop: 13, name: "soja"},
    {idHome: 0, idShop: 6.1, name: "riz"},
    {idHome: 0, idShop: 6.1, name: "spaghettis"},
    {idHome: 0, idShop: 6.1, name: "coquillettes"},
    {idHome: 0, idShop: 6, name: "pom'potes"},
    {idHome: 0, idShop: 6.5, name: "gouters"},
    {idHome: 0, idShop: 7, name: "lait"},
    {idHome: 0, idShop: 7, name: "œufs"},
    //
    // cuisine
    //
    {idHome: 0, idShop: 6.5, name: "chocolat"},
    ]

    // upper case first letter
    itemList.forEach( (item, id)=>{
        item.name = item.name.charAt(0).toUpperCase() + item.name.slice(1);
    });


    // create list based on home ordering
    function populateList(){

        // sort based on home id
        // itemList.sort(function(a,b) { return a.idHome - b.idHome;});

        // add element to dom
        itemList.forEach( (item, id) => {

            // addElement(itemList[id].name);

            var btn = document.createElement("button");
            btn.className = "toggle-button"
            btn.innerHTML = itemList[id].name
            document.getElementById("list-div").appendChild(btn);

            btn.addEventListener("click", () => {
                btn.classList.toggle("active");
                // Optional: use a custom data attribute to represent the state
                btn.dataset.checked = btn.classList.contains("active");
                // console.log("Checked:", btn.dataset.checked);
            });
        });
    }


    // export list based on shop ordering
    function exportList(){

        // get list of checked element names
        var objects = document.body.getElementsByClassName("toggle-button");

        list = [];
        for(let obj of objects){

            // discard if not ticked
            if( !obj.classList.contains("active") ){ continue; }

            // find reference of line text in itemList names
            var item = itemList.filter(elmt => {
                return elmt.name == obj.innerText.trim();
            });

            // save to local
            list.push(item[0]);
        }

        // sort based on shop id
        list.sort(function(a,b) { return a.idShop - b.idShop;});

        // convert list of items to list of labels
        labelList = []
        list.forEach( (item, id) => {
            v =  item.name;
            // v =  item.name + ' (home: ' + item.idHome + ', shop: ' + item.idShop + ')';
            labelList.push('<p style="font-size:22px;"> ' + v + '</p>');
        });

        // open new page
        // var w = window.open("", "_self"); // open in same page
        var w = window.open(""); // open in new page

        // populate
        w.document.writeln('<html><head><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="styles.css"><title>Liste Courses</title></head><body><div>' + labelList.join("") + '</div></body></html>');
        w.document.close();
        // document.body.innerHTML=labelList.join("");
    }

    </script>

</html>
